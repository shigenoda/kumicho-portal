# 組長業務 引き継ぎポータル - TODO（6次実装完了）

## ✓ 完了項目

### フェーズ 1: Minato Editorial Luxury デザイン設計と Private Vault 要件確認
- [x] デザイン方針確認（港区ミニマル・ラグジュアリー）
- [x] Private Vault 要件確認
- [x] ローテ自動計算ロジック（案A）確認
- [x] Member トップを「雑誌の目次」型に設計
- [x] ヒーロー背景：グラデ + ノイズで実装
- [x] コンテナ最大幅、余白設定確認
- [x] タイポ設定：Inter + Noto Sans JP
- [x] 色設定：オフホワイト背景、濃いグレー文字、低彩度青緑アクセント

### フェーズ 2: DB スキーマ拡張
- [x] audit_logs テーブル作成
- [x] vault_entries テーブル作成
- [x] data_classification テーブル作成
- [x] DB マイグレーション実行
- [x] 既存テーブル拡張（posts, inventory, templates, rules, faq に classification 追加）

### フェーズ 3: Member トップ刷新
- [x] 左上：小さめのラベル（YEAR / AREA）実装
- [x] 中央：大きい H1（「組長引き継ぎ」）実装
- [x] 下：Index List（01..07）実装
- [x] 右下：小さな更新ログ（Last updated）実装
- [x] ヒーロー背景（グラデ + ノイズ）+ オーバーレイ実装
- [x] 余白重視、線と影は最小限
- [x] タイポ階層明確化
- [x] モバイルレスポンシブ確認

### フェーズ 4: Private Vault 実装
- [x] Vault 閲覧画面（Admin限定）実装
- [x] マスキング表示（デフォルト）実装
- [x] チェックボックスで一時表示実装
- [x] コピー機能実装
- [x] 個人情報の取扱注意警告表示
- [x] Admin 監査ログ画面実装
- [x] 監査ログ一覧表示（誰が、いつ、何を）
- [x] フィルタ機能（アクション別）実装
- [x] 統計表示実装
- [x] ルーティング追加（/vault, /audit-logs）
- [x] Admin限定チェック実装

### フェーズ 5: 住戸データとローテーションルールの Seed 投入
- [x] 住戸 9 件（101, 102, 103, 201, 202, 203, 301, 302, 303）
- [x] 免除ルール 3 種（A: 入居12ヶ月未満、B: 直近組長、C: 就任困難申告）
- [x] 免除ステータスデータ
- [x] 過去の組長担当履歴

### フェーズ 6: 先9年ローテ自動計算ロジックの実装
- [x] 入居年月が古い順でソート
- [x] 免除対象（A/B/C）を自動判定
- [x] 繰上げ処理
- [x] 先9年分のローテを生成（2026〜2034）
- [x] 選定理由を記録

### フェーズ 7: ローテーション表示ページ
- [x] /rotation ページ作成
- [x] ローテ表を表示（年度、Primary、Backup、ステータス、選定理由）
- [x] 住戸一覧と免除状態を表示
- [x] 免除タイプ一覧を表示
- [x] Member トップに「05: 組長ローテーション」リンク追加

### フェーズ 8: Seed データ投入
- [x] イベント（5件）：組長会議、河川清掃（春・秋）、会費締切
- [x] 備品（10件）：トング、ゴミ袋、熊手、テント等
- [x] テンプレ（4件）：河川清掃依頼、会費徴収、案内文、リマインド
- [x] ルール（3件）：会費、ローテーション、出不足金
- [x] FAQ（5件）：会費、河川清掃、備品、免除、個人情報
- [x] 年度ログ（5件）：日程決定、Q&A、検討事項、トラブル対応、チェックリスト更新
- [x] 引き継ぎ袋（5件）：鍵、印鑑、帳簿
- [x] Vault エントリ（3件）：組長連絡先、管理会社連絡先、出不足金記録
- [x] 変更履歴（5件）：最新の更新記録
- [x] 返信待ちキュー（3件）：参加確認、意見募集、修繕依頼

## 6次実装：編集機能・出欠表・通知システム（完了）

### フェーズ 1: DBスキーマ拡張
- [x] 河川清掃出欠イベントテーブル（river_cleaning_events）
- [x] 出欠回答テーブル（attendance_responses）
- [x] 住民メールアドレステーブル（household_emails）
- [x] リマインダー送信履歴テーブル（reminder_logs）
- [x] 編集履歴テーブル（edit_history）
- [x] DBマイグレーション実行

### フェーズ 2: 河川清掃出欠表システム
- [x] 出欠イベント作成API（Admin）
- [x] 出欠回答入力API（誰でも）
- [x] 出欠状況取得API
- [x] 出欠入力ページUI（/attendance, /attendance/:id）
- [x] 入力状況表示（何人入力済み）
- [x] Admin 回答一覧ページ（/attendance/:id/admin）

### フェーズ 3: 住民メールアドレス登録
- [x] メールアドレス登録API
- [x] メールアドレス一覧取得API（Admin）
- [x] メールアドレス登録UI（/email-settings）

### フェーズ 4: メール通知・リマインダー
- [x] 出欠入力時の組長へのメール通知（notifyOwner）
- [x] 未入力者へのリマインダーメール送信API（Admin）
- [x] リマインダーログ記録

### フェーズ 5: 全ページ編集機能
- [x] 年度ログ編集・新規作成
- [x] ルール編集・新規作成
- [x] 備品編集・新規作成
- [x] 編集履歴記録

### フェーズ 6: 備品台帳写真アップロード
- [x] 備品写真アップロードAPI（/api/upload/inventory-photo）
- [x] 備品写真表示UI
- [x] S3連携（storagePut）
- [x] 写真プレビュー・削除機能

### フェーズ 7: テスト・チェックポイント
- [x] 出欠表テスト（attendance.test.ts）
- [x] 編集機能テスト
- [x] 全23テスト合格
- [x] チェックポイント作成

## 実装内容サマリー

**DB テーブル数：** 25 個（+4）
- 新規追加：river_cleaning_events, attendance_responses, household_emails, reminder_logs, edit_history

**ページ数：** 19 個（+4）
- 新規追加：出欠表一覧（/attendance）、出欠入力（/attendance/:id）、Admin回答一覧（/attendance/:id/admin）、メール設定（/email-settings）

**API数：** 40+ 個
- 新規追加：attendance.*, email.*, edit.*, upload.*

**テスト数：** 23 個（全合格）
- rotation.test.ts: 13 tests
- auth.logout.test.ts: 1 test
- attendance.test.ts: 9 tests

## 次のステップ候補

1. **検索機能の実装**：全文検索（河川、備品、会費など）
2. **FAQ編集UI**：FAQ の編集・新規作成ダイアログ
3. **ローテーション編集機能**：Admin がローテを編集
4. **カレンダー編集機能**：イベントの追加・編集
5. **メール認証機能**：住民メールの認証フロー
6. **リマインダー自動送信**：締切前の自動リマインダー


## 7次実装：FAQ・テンプレート編集機能（完了）

### FAQ編集機能
- [x] FAQ追加ダイアログ
- [x] FAQ編集ダイアログ
- [x] FAQ削除機能
- [x] FAQ API（create, update, delete）

### テンプレート編集機能
- [x] テンプレート追加ダイアログ
- [x] テンプレート編集ダイアログ
- [x] テンプレート削除機能
- [x] テンプレート API（create, update, delete）

### テスト・チェックポイント
- [x] 動作確認
- [x] チェックポイント作成


## 8次実装：年間カレンダー編集機能（完了）

### イベント CRUD API
- [x] イベント作成 API（createEvent）
- [x] イベント更新 API（updateEvent）
- [x] イベント削除 API（deleteEvent）

### カレンダー編集 UI
- [x] イベント追加ダイアログ
- [x] イベント編集ダイアログ
- [x] イベント削除確認
- [x] チェックリスト編集機能

### テスト・チェックポイント
- [x] 動作確認
- [x] チェックポイント作成


## 9次実装：Private Vault 編集機能
## 9次実装：Private Vault 編集機能（完了）

### Vault CRUD API
- [x] Vault エントリ作成 API（create）
- [x] Vault エントリ更新 API（update）
- [x] Vault エントリ削除 API（delete）
- [x] 監査ログ記録

### Vault 編集 UI
- [x] エントリ追加ダイアログ
- [x] エントリ編集ダイアログ
- [x] エントリ削除確認
- [x] カテゴリ選択
- [x] 機密レベル選択

### テスト・チェックポイント
- [x] 動作確認
- [x] チェックポイント作成


## 10次実装：ローテーション管理機能（完了）

### ローテーションステータス更新 API
- [x] ステータス更新 API（updateLeaderSchedule）
- [x] Primary/Backup 住戸変更 API
- [x] 変更履歴記録

### ローテーション管理 UI
- [x] ステータス変更ボタン（仮→条件付き→確定）
- [x] 編集ダイアログ（Primary/Backup/ステータス/理由）
- [x] ステータス別の色分け表示
- [x] 変更履歴表示

### テスト・チェックポイント
- [x] 動作確認
- [x] チェックポイント作成


## 11次実装：免除申請システム（完了）

### DBスキーマ
- [x] 免除申請テーブル（exemption_requests）を使用
- [x] 申請ステータス（pending/approved/rejected）

### 免除申請 API
- [x] 申請作成 API（createApplication）
- [x] 申請一覧取得 API（getApplications）
- [x] 承認 API（approveApplication）
- [x] 却下 API（rejectApplication）
- [x] 通知機能（申請時・承認/却下時）

### 住民用免除申請フォーム
- [x] 申請フォームページ（ExemptionApplication.tsx）
- [x] 住戸選択
- [x] 申請理由入力
- [x] 申請履歴表示

### 管理者用承認・却下画面
- [x] 申請一覧ページ（ExemptionAdmin.tsx）
- [x] 承認ボタン
- [x] 却下ボタン（却下理由入力）
- [x] 申請詳細表示

### テスト・チェックポイント
- [x] 動作確認
- [x] テスト作成（exemption.test.ts）
- [x] 全59テスト合格


## 12次実装：引き継ぎ物品チェックリスト機能（完了）

### 引き継ぎ物品 CRUD API
- [x] 物品追加 API（createItem）
- [x] 物品一覧取得 API（getItems）
- [x] 物品編集 API（updateItem）
- [x] 物品削除 API（deleteItem）

### チェックリストページ
- [x] 引き継ぎ物品一覧表示（HandoverBag.tsx）
- [x] 物品の追加・編集・削除ダイアログ
- [x] チェック状态の保存
- [x] 進捗バー表示

### チェックイン・チェックアウト機能
- [ ] チェックイン時のチェックリスト確認
- [ ] チェックアウト時のチェックリスト確認
- [ ] 確認履歴の記録

### テスト・チェックポイント
- [x] 動作確認
- [x] テスト作成（handover.test.ts）
- [x] 全65テスト合格
